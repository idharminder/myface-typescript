<html lang="en-gb">
<%- include('_head') -%>
<%- include('_header') -%>
<body>
<h1>Posts</h1>
<ol>
    <% postList.results.forEach(function(post) {%>
        <li class="post">
            <div class="post-head">
                <h2><%= post.message %></h2>
                <p>Created by: <%= post.postedBy.username %></p>
                <p>Created at: <%= format(post.createdAt, "yyyy-MM-dd HH:mm:ss") %></p>
            </div>
            
            
            <div class="post-image">                
                <img src= <%= post.imageUrl %> alt="post.imageUrl">
            </div>
            
            
            <div class="post-foot">  
                <%const myLiked = post.likedBy.some(user => user.id === 1) %>
                <%const myDisliked = post.dislikedBy.some(user => user.id === 1) %>
    
                <% let prefString = "" %>
                <%if (myLiked) { %>
                    <% prefString = "Liked by you!" %>
                    <%}%>
                    
                <%if (myDisliked) { %>
                    <% prefString = "Disliked by you!" %>
                    <%}%>
    
                <%if (!myLiked && !myDisliked) {%>
                        <form method="POST" action="/posts/<%=post.id%>/like/" aria-label="likes">
                            <button type="submit">
                        👍      <%= post.likedBy.length%>
                            </button>
                        </form> 
                        <form method="POST" action="/posts/<%=post.id%>/dislike/" aria-label="dislikes">
                            <button type="submit">
                                👎 <%= post.dislikedBy.length%>
                            </button>
                        </form>
                <%}; %>
    
                <%if (myLiked || myDisliked) {%>
                    <p><%=prefString%></p>
                    <p>
                        👍 <%= post.likedBy.length%>
                    </p>
                    <p>
                        👎 <%= post.dislikedBy.length%>
                    </p>
                <%}; %>
            </div>
        </li>
    <% }); %>
</ol>

<%if (postList.next) { %>
    <a href="<%= postList.next %>">Next</a>
<% } %>
<%if (postList.previous) { %>
    <a href="<%= postList.previous %>">Previous</a>
<% } %>


</body>
<%- include('_footer') -%>
</html>